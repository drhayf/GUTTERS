const sharp = require('sharp');
const fs = require('fs');
const path = require('path');

const pwaDir = 'public/pwa';
if (!fs.existsSync(pwaDir)) fs.mkdirSync(pwaDir, { recursive: true });

async function run() {
    try {
        // Generate favicon (32x32 PNG saved as ico)
        await sharp('source-icon.svg')
            .resize(32, 32)
            .png()
            .toFile(path.join(pwaDir, 'favicon.ico'));
        console.log('✓ Created favicon.ico');

        // Copy to maskable names
        // generated by generate-pwa-icons-temp.cjs previously

        // We expect public/icons/icon-192.png etc to be present (we will run generation just before this)

        fs.copyFileSync('public/icons/icon-192.png', path.join(pwaDir, 'manifest-icon-192.maskable.png'));
        console.log('✓ Created manifest-icon-192.maskable.png');

        fs.copyFileSync('public/icons/icon-512.png', path.join(pwaDir, 'manifest-icon-512.maskable.png'));
        console.log('✓ Created manifest-icon-512.maskable.png');

        fs.copyFileSync('public/apple-touch-icon.png', path.join(pwaDir, 'apple-touch-icon.png'));
        console.log('✓ Created apple-touch-icon.png');

    } catch (err) {
        console.error('Error finalizing:', err);
        process.exit(1);
    }
}

run();
