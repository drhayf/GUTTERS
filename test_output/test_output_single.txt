2026-01-24T05:44:13.349182Z [info     ] Registered module: human_design (layer: calculation) [src.app.modules.registry]
2026-01-24T05:44:14.373969Z [info     ] Registered module: numerology (layer: calculation) [src.app.modules.registry]
2026-01-24T05:44:14.424418Z [info     ] Registered module: synthesis (layer: intelligence) [src.app.modules.registry]
2026-01-24T05:44:14.444447Z [info     ] Registered module: query (layer: intelligence) [src.app.modules.registry]
2026-01-24T05:44:15.249310Z [info     ] Registered module: observer (layer: intelligence) [src.app.modules.registry]
============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-9.0.2, pluggy-1.6.0 -- C:\dev\GUTTERS\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\dev\GUTTERS
configfile: pyproject.toml
plugins: anyio-4.12.1, Faker-37.3.0, langsmith-0.6.4, asyncio-1.3.0, mock-3.14.1
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1 item

tests/integration/test_end_to_end.py::test_complete_user_journey FAILED

================================== FAILURES ===================================
_________________________ test_complete_user_journey __________________________

db = <sqlalchemy.ext.asyncio.session.AsyncSession object at 0x0000025A2D6757C0>
clean_redis = None

    @pytest.mark.asyncio
    async def test_complete_user_journey(db, clean_redis):
        """
        Complete user journey from registration to AI interaction.
    
        This test verifies:
        1. User creation
        2. Profile initialization
        3. Module calculations
        4. Synthesis generation
        5. Active Memory
        6. Chat conversation
        7. Journal entry
        8. Vector search
        9. Observer detection
        10. Query with full context
        """
    
        # Needs real DB session, not just the fixture, but the fixture 'db' IS a session
        real_db = db
    
        # ========================================
        # STEP 1: Create User
        # ========================================
        from src.app.models.user import User
        from src.app.models.user_profile import UserProfile
    
        # Randomize user to avoid DB collisions
        uid = str(uuid.uuid4())[:8]
        user = User(
            name=f"Test Journey {uid}",
            username=f"tj_{uid}",
            email=f"test_journey_{uid}@example.com",
            hashed_password="hashed_secret",
            birth_date=date(1990, 6, 15),
            birth_time=time(14, 30),
            birth_location="New York, NY, USA",
            birth_latitude=40.7128,
            birth_longitude=-74.0060,
            birth_timezone="America/New_York",
        )
    
        real_db.add(user)
        await real_db.commit()
        await real_db.refresh(user)
    
>       print(f"\u2713 User created (ID: {user.id})")

tests\integration\test_end_to_end.py:59: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <colorama.ansitowin32.StreamWrapper object at 0x0000025A78A0A750>
text = '\u2713 User created (ID: 17)'

    def write(self, text):
>       self.__convertor.write(text)

.venv\Lib\site-packages\colorama\ansitowin32.py:47: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <colorama.ansitowin32.AnsiToWin32 object at 0x0000025A78A0A6F0>
text = '\u2713 User created (ID: 17)'

    def write(self, text):
        if self.strip or self.convert:
>           self.write_and_convert(text)

.venv\Lib\site-packages\colorama\ansitowin32.py:177: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <colorama.ansitowin32.AnsiToWin32 object at 0x0000025A78A0A6F0>
text = '\u2713 User created (ID: 17)'

    def write_and_convert(self, text):
        '''
        Write the given text to our wrapped stream, stripping any ANSI
        sequences from the text, and optionally converting them into win32
        calls.
        '''
        cursor = 0
        text = self.convert_osc(text)
        for match in self.ANSI_CSI_RE.finditer(text):
            start, end = match.span()
            self.write_plain_text(text, cursor, start)
            self.convert_ansi(*match.groups())
            cursor = end
>       self.write_plain_text(text, cursor, len(text))

.venv\Lib\site-packages\colorama\ansitowin32.py:205: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <colorama.ansitowin32.AnsiToWin32 object at 0x0000025A78A0A6F0>
text = '\u2713 User created (ID: 17)', start = 0, end = 23

    def write_plain_text(self, text, start, end):
        if start < end:
>           self.wrapped.write(text[start:end])

.venv\Lib\site-packages\colorama\ansitowin32.py:210: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <encodings.cp1252.IncrementalEncoder object at 0x0000025A70C68080>
input = '\u2713 User created (ID: 17)', final = False

    def encode(self, input, final=False):
>       return codecs.charmap_encode(input,self.errors,encoding_table)[0]
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       UnicodeEncodeError: 'charmap' codec can't encode character '\u2713' in position 0: character maps to <undefined>

C:\Python312\Lib\encodings\cp1252.py:19: UnicodeEncodeError
============================== warnings summary ===============================
src\app\modules\intelligence\synthesis\schemas.py:21
  C:\dev\GUTTERS\src\app\modules\intelligence\synthesis\schemas.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class UnifiedProfile(BaseModel):

src\app\modules\intelligence\query\schemas.py:9
  C:\dev\GUTTERS\src\app\modules\intelligence\query\schemas.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class QueryRequest(BaseModel):

src\app\modules\intelligence\hypothesis\models.py:32
  C:\dev\GUTTERS\src\app\modules\intelligence\hypothesis\models.py:32: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Hypothesis(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/integration/test_end_to_end.py::test_complete_user_journey - Uni...
======================== 1 failed, 3 warnings in 0.88s ========================
