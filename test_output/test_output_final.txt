2026-01-24T05:46:52.977150Z [info     ] Registered module: human_design (layer: calculation) [src.app.modules.registry]
2026-01-24T05:46:53.973855Z [info     ] Registered module: numerology (layer: calculation) [src.app.modules.registry]
2026-01-24T05:46:54.016519Z [info     ] Registered module: synthesis (layer: intelligence) [src.app.modules.registry]
2026-01-24T05:46:54.034971Z [info     ] Registered module: query (layer: intelligence) [src.app.modules.registry]
2026-01-24T05:46:54.870897Z [info     ] Registered module: observer (layer: intelligence) [src.app.modules.registry]
============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-9.0.2, pluggy-1.6.0 -- C:\dev\GUTTERS\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\dev\GUTTERS
configfile: pyproject.toml
plugins: anyio-4.12.1, Faker-37.3.0, langsmith-0.6.4, asyncio-1.3.0, mock-3.14.1
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1 item

tests/integration/test_end_to_end.py::test_complete_user_journey [OK] User created (ID: 21)
[OK] Profile initialized
FAILED

================================== FAILURES ===================================
_________________________ test_complete_user_journey __________________________

db = <sqlalchemy.ext.asyncio.session.AsyncSession object at 0x00000245C5D156A0>
clean_redis = None

    @pytest.mark.asyncio
    async def test_complete_user_journey(db, clean_redis):
        """
        Complete user journey from registration to AI interaction.
    
        This test verifies:
        1. User creation
        2. Profile initialization
        3. Module calculations
        4. Synthesis generation
        5. Active Memory
        6. Chat conversation
        7. Journal entry
        8. Vector search
        9. Observer detection
        10. Query with full context
        """
    
        # Needs real DB session, not just the fixture, but the fixture 'db' IS a session
        real_db = db
    
        # ========================================
        # STEP 1: Create User
        # ========================================
        from src.app.models.user import User
        from src.app.models.user_profile import UserProfile
    
        # Randomize user to avoid DB collisions
        uid = str(uuid.uuid4())[:8]
        user = User(
            name=f"Test Journey {uid}",
            username=f"tj_{uid}",
            email=f"test_journey_{uid}@example.com",
            hashed_password="hashed_secret",
            birth_date=date(1990, 6, 15),
            birth_time=time(14, 30),
            birth_location="New York, NY, USA",
            birth_latitude=40.7128,
            birth_longitude=-74.0060,
            birth_timezone="America/New_York",
        )
    
        real_db.add(user)
        await real_db.commit()
        await real_db.refresh(user)
    
        print(f"[OK] User created (ID: {user.id})")
    
        # Verify profile created
        from sqlalchemy import select
    
        result = await real_db.execute(select(UserProfile).where(UserProfile.user_id == user.id))
        profile = result.scalar_one_or_none()
    
        # If not created by triggers (which might not be present in test DB), create manually
        if not profile:
            profile = UserProfile(user_id=user.id, data={})
            real_db.add(profile)
            await real_db.commit()
            await real_db.refresh(profile)
    
        assert profile is not None
    
        print(f"[OK] Profile initialized")
    
        # ========================================
        # STEP 2: Calculate Profiles (All Modules)
        # ========================================
>       from src.app.modules.profiles.astrology.calculator import AstrologyCalculator
E       ModuleNotFoundError: No module named 'src.app.modules.profiles'

tests\integration\test_end_to_end.py:81: ModuleNotFoundError
============================== warnings summary ===============================
src\app\modules\intelligence\synthesis\schemas.py:21
  C:\dev\GUTTERS\src\app\modules\intelligence\synthesis\schemas.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class UnifiedProfile(BaseModel):

src\app\modules\intelligence\query\schemas.py:9
  C:\dev\GUTTERS\src\app\modules\intelligence\query\schemas.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class QueryRequest(BaseModel):

src\app\modules\intelligence\hypothesis\models.py:32
  C:\dev\GUTTERS\src\app\modules\intelligence\hypothesis\models.py:32: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Hypothesis(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/integration/test_end_to_end.py::test_complete_user_journey - Mod...
======================== 1 failed, 3 warnings in 1.05s ========================
